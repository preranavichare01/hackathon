import chromadb
import pandas as pd
import os

# Initialize ChromaDB client
client = chromadb.Client()
collection = client.get_or_create_collection("energial_data")
 
# Dataset metadata and formatting
datasets = {
    "energy_usage.csv": lambda row: f"Timestamp: {row['timestamp']}, Energy: {row['energy']} kWh, Carbon Intensity: {row['carbon_intensity']} gCO2/kWh",
    "device_consumption.csv": lambda row: f"Device: {row['device']} used for {row['usage_time']} hrs, Consumed: {row['energy_consumed']} kWh",
    "building_info.csv": lambda row: f"Building ID: {row['building_ID']}, Location: {row['location']}, Occupancy: {row['occupancy']}, Type: {row['type']}",
    "carbon_report.csv": lambda row: f"Region: {row['region']}, Timestamp: {row['timestamp']}, Carbon Output: {row['carbon_output']} gCO2eq, Threshold: {row['regulatory_threshold']}"
}

# Load and insert each dataset
for file, formatter in datasets.items():
    df = pd.read_csv(f"data/{file}")
    for i, row in df.iterrows():
        doc = formatter(row)
        collection.add(
            documents=[doc],
            ids=[f"{file}_{i}"]
        )

print("âœ… All 4 datasets uploaded to ChromaDB.")
